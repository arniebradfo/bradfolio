<article *ngIf="post">

  <h1 [routerLink]="'/'+post.slug">
    {{ post?.title.rendered }}
  </h1>

  <p>
    <strong>By: </strong>
    <a [routerLink]="'/author/' + post.author_ref.slug">
      {{ post.author_ref.name }}
    </a>
    <span>
      {{ post.date | date: 'MMM d, y, h:mm a' }}
    </span>
  </p>

  <img *ngIf="post.featured_media_ref" [src]="post.featured_media_ref.media_details.sizes.thumbnail.source_url" />

  <p *ngIf="post.tags_ref != null && post.tags_ref.length > 0">
    <strong>Tags: </strong>
    <a *ngFor="let tag of post.tags_ref" [routerLink]="'/tag/' + tag.slug">
      {{'#' + tag.name}}
    </a>
  </p>
  <p *ngIf="post.categories_ref != null && post.categories_ref.length > 0">
    <strong>Categories: </strong>
    <a *ngFor="let category of post.categories_ref" [routerLink]="'/category/' + category.slug">
      {{category.name}}
    </a>
  </p>

  <!-- <form *ngIf="showPasswordForm" #passwordForm="ngForm" (ngSubmit)="onSubmitPassword()">
      <h4>This post is password protected</h4>
      <input type="password" [(ngModel)]="password" name="password" placeholder="password" required/>
      <button type="submit" [disabled]="!passwordForm.form.valid">Submit</button>
      {{errorMessage}}
      <hr/>
    </form> -->

  <ngwp-content [content]="showFull ? post?.content.rendered : post?.excerpt.rendered"></ngwp-content>

  <ng-container *ngIf="showFull && viewModelService.commentList$ | async as commentList">

    <ngwp-comment-form *ngIf="rootCommentFormOpen" [post]="post"></ngwp-comment-form>
    
      <ol id="comments" *ngIf="commentList.comments as comments">
        <hr/>
        <ng-template #recursiveList let-comments>
          <li *ngFor="let comment of comments">
            <h6>{{comment.author_name}} at {{comment.date | date: 'MMM d, y, h:mm a' }}</h6>
            <p [innerHTML]="comment.content.rendered"></p>
            <ngwp-comment-form *ngIf="comment.formOpen" [post]="post" [parent]="comment"></ngwp-comment-form>
            <button *ngIf="!comment.formOpen" (click)="openCommentReply(comment)">Reply!</button>
            <button *ngIf="comment.formOpen" (click)="closeCommentReply(comment)">Cancel</button>
            <ul *ngIf="comment.children?.length > 0">
              <ng-container *ngTemplateOutlet="recursiveList; context:{ $implicit: comment.children }"></ng-container>
            </ul>
          </li>
        </ng-template>
        <ng-container *ngTemplateOutlet="recursiveList; context:{ $implicit: comments }"></ng-container>
      </ol>
    
      <nav *ngIf="commentList.commentsPageCount?.length > 1">
        <span>Comments Pagination</span>
        <ul>
          <li 
            *ngFor="let count of commentList.commentsPageCount; let i = index" 
            [routerLink]="'/' + post.slug + '/comments-page/' + (i+1)"
            >
            {{i+1}}
          </li>
        </ul>
      </nav>
    
  </ng-container>

  <nav *ngIf="adjcentPosts && showFull">
    <strong>Previous Post:</strong>
    <a [routerLink]="'/' + adjcentPosts.previous.slug" [innerHTML]="adjcentPosts.previous.title.rendered"></a>
    <br/>
    <strong>Next Post:</strong>
    <a [routerLink]="'/' + adjcentPosts.next.slug" [innerHTML]="adjcentPosts.next.title.rendered"></a>
  </nav>

</article>